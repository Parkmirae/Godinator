<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.kitri.godinator.mentor.dao.ChatDao">
  
  <select id="selOncate" parameterType="String" resultType="String">
  SELECT cate
  FROM mentor
  WHERE user_id = #{id} and mentor = 'y'
  </select>
  
  <insert id="insertOnChat" parameterType="onChatDto">
  INSERT INTO onchat(user_id, oncate)
  VALUES (#{userId}, #{oncate})
  </insert>
  
  <delete id="deleteOnChat" parameterType="String">
  DELETE onchat
  WHERE user_id = #{id}
  </delete>
  
  <select id="selOnMentor" parameterType="Map" resultType="memberDto">
  <if test="cate1==1">
  SELECT m.user_id userId, h.school_name hSchoolCode, h.school_cate1 hSchoolCate
  FROM member m, h_school h
  WHERE m.H_SCHOOL_CODE = h.SCHOOL_CODE
	  <if test="cate2 != '0'">
	  	and m.H_SCHOOL_CATE = #{cate2}
	  </if>
  </if>
  <if test="cate1==2">
  SELECT m.user_id userId, u.school_name uSchoolCode, m.U_SCHOOL_CATE uSchoolCate
  FROM member m, u_school u
  WHERE m.H_SCHOOL_CODE = u.SCHOOL_CODE
  	<if test="cate2 != '0'">
	  	and m.U_SCHOOL_CATE = #{cate2}
	  </if>
  </if>
  <if test="search != ''">
  		and ${cate3} = #{search}
  </if>
  </select>
  
  </mapper>